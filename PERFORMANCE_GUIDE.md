# 🚀 크롤링 성능 최적화 가이드

기존 `meat.js`의 성능을 대폭 개선한 두 가지 최적화 버전을 제공합니다.

## 📊 성능 비교

| 버전 | 처리 방식 | 예상 속도 향상 | 메모리 사용량 | 안정성 | 보안 회피 |
|------|-----------|----------------|---------------|--------|-----------|
| **meat.js (기존)** | 순차 처리 | 기준 (1x) | 낮음 | 높음 | ✅ 높음 |
| **meat-secure.js** ⭐ | 보안 고려 병렬 처리 | 2-3x 빠름 | 중간 | 높음 | ✅ 높음 |
| **meat-optimized.js** | 최적화된 병렬 처리 | 3-5x 빠름 | 중간 | 높음 | ⚠️ 낮음 |
| **meat-turbo.js** | 초고속 병렬 처리 | 5-10x 빠름 | 높음 | 중간 | ⚠️ 낮음 |

## 🔧 주요 최적화 기법

### 1. 기존 버전 (meat.js)의 문제점
- ❌ 매 요청마다 브라우저 새로 생성/종료
- ❌ 월별 순차 처리 (for loop with await)
- ❌ 리그별 순차 처리
- ❌ 고정 딜레이 (100-200ms)

### 2. 최적화 버전 (meat-optimized.js)
- ✅ 브라우저 인스턴스 재사용
- ✅ 월별 병렬 처리 (Promise.all)
- ✅ 페이지 풀링 (3개 동시 페이지)
- ✅ 리그별 병렬 처리 (2개 동시)
- ✅ 딜레이 제거

### 3. 보안 고려 버전 (meat-secure.js) ⭐ 추천
- ✅ 브라우저 정기 재시작 (3개 요청마다)
- ✅ User Agent 랜덤화
- ✅ 뷰포트 랜덤화  
- ✅ 웹드라이버 탐지 방지
- ✅ 적절한 병렬 처리 (2개 동시)
- ✅ 배치 간 랜덤 대기
- ✅ 브라우저 지문 우회 기능

### 4. 터보 버전 (meat-turbo.js)
- ✅ 모든 최적화 버전 기능 포함
- ✅ 더 많은 동시 작업 (8개)
- ✅ 여러 브라우저 인스턴스 (최대 3개)
- ✅ 리소스 차단 (이미지, CSS 등)
- ✅ 청크 단위 대량 병렬 처리
- ✅ 더 빠른 네비게이션 설정
- ⚠️ 보안 차단 위험 높음

## 🚀 사용법

### 기본 실행
```bash
# 기존 버전 (느림)
node meat.js

# 보안 고려 버전 (추천) ⭐
node meat-secure.js

# 최적화 버전
node meat-optimized.js

# 터보 버전 (최고속, 차단 위험)
node meat-turbo.js
```

### 필터링 옵션
```bash
# 특정 연도만
node meat-optimized.js --year=2025

# 특정 월만
node meat-optimized.js --month=03

# 특정 리그만
node meat-optimized.js --league=K5

# 조합 사용
node meat-turbo.js --year=2025 --league=K5 --month=03
```

## ⚡ 권장 사용 시나리오

### 🛡️ meat-secure.js (추천) ⭐
- **언제 사용**: joinkfa 보안을 회피하면서 성능 향상이 필요할 때
- **장점**: 보안 회피 + 적절한 성능 향상
- **적합한 경우**:
  - 기존 meat.js에서 차단 경험이 있는 경우
  - 안정성을 우선하면서도 속도 향상이 필요한 경우
  - 일반적인 크롤링 작업 (가장 추천)

### 🟢 meat-optimized.js (성능 우선)
- **언제 사용**: 보안 차단이 없는 것이 확실한 경우
- **장점**: 높은 성능
- **적합한 경우**:
  - joinkfa 보안 정책이 변경된 경우
  - 테스트 환경이나 내부 네트워크
  - 빠른 처리가 중요하고 차단 위험을 감수할 수 있는 경우

### 🔥 meat-turbo.js (최고 성능, 높은 위험)
- **언제 사용**: 매우 제한적인 상황에서만
- **장점**: 최고 속도
- **위험**: 서버 차단 가능성 높음
- **적합한 경우**:
  - 일회성 대량 크롤링
  - 보안 정책이 느슨한 것이 확실한 경우

### ⚠️ joinkfa 보안 관련 주의사항
- **기존 버전이 브라우저를 매번 재시작하는 이유**: 세션 기반 요청 제한 회피
- **권장**: `meat-secure.js` 사용으로 보안과 성능의 균형 확보
- **보안 차단 증상**: 403 에러, 빈 응답, IP 차단 등
- **차단 시 대처**: 기존 `meat.js`로 복귀하거나 대기 시간 증가

## 🔧 성능 튜닝

### meat-optimized.js 설정 조정
```javascript
// 리그 병렬 처리 수 (기본: 2)
await processLeaguesParallel(LEAGUE_LIST, MONTHS, 3);

// 페이지 풀 크기 (기본: 3)
const browserManager = new BrowserManager(5);
```

### meat-turbo.js 설정 조정
```javascript
// 동시 작업 수 (기본: 8)
const browserManager = new TurboBrowserManager(10);

// 청크 크기 (기본: 20)
const chunkSize = 30;

// 청크 간 휴식 시간 (기본: 500ms)
await new Promise(resolve => setTimeout(resolve, 300));
```

## 📈 예상 성능 향상

### 10개 리그, 10개월 크롤링 기준
- **기존 버전**: ~15-20분
- **최적화 버전**: ~3-5분 (75% 단축)
- **터보 버전**: ~1-3분 (85% 단축)

### 50개 리그, 10개월 크롤링 기준
- **기존 버전**: ~75-100분
- **최적화 버전**: ~15-25분 (80% 단축)
- **터보 버전**: ~5-15분 (90% 단축)

## 🛠️ 트러블슈팅

### 메모리 부족 오류
```bash
# Node.js 메모리 한도 증가
node --max-old-space-size=4096 meat-turbo.js
```

### 연결 오류가 자주 발생하는 경우
```javascript
// meat-turbo.js에서 청크 크기 줄이기
const chunkSize = 10; // 20에서 10으로

// 휴식 시간 늘리기
await new Promise(resolve => setTimeout(resolve, 1000)); // 500ms에서 1000ms로
```

### Chrome 실행 오류
```bash
# Chrome 설치 스크립트 실행
node scripts/install-chrome.js
```

## 📊 실시간 진행 상황 모니터링

모든 최적화 버전은 다음 정보를 실시간으로 표시합니다:
- 📦 청크별 처리 진행상황 (터보 버전)
- ⏱️ 각 리그별 처리 시간
- 📈 전체 처리 속도 (작업/분)
- 🎯 성공/실패 통계

## 🎯 결론

- **일반 사용자**: `meat-secure.js` 사용 (보안 + 성능) ⭐
- **고급 사용자**: 상황에 따라 `meat-optimized.js` 또는 `meat-turbo.js`
- **안전 우선**: `meat.js` (기존 버전) 사용

모든 최적화 버전들은 기존 코드와 100% 호환되며, 동일한 결과 파일을 생성합니다.

## 🔍 joinkfa 보안 메커니즘 분석

joinkfa는 다음과 같은 보안 메커니즘을 사용할 가능성이 높습니다:

1. **세션 기반 요청 제한**: 동일한 브라우저 세션에서 너무 많은 요청 시 차단
2. **브라우저 지문 인식**: 자동화 도구 탐지 및 차단
3. **요청 패턴 분석**: 비정상적인 요청 패턴 탐지
4. **IP 기반 제한**: 동일한 IP에서 과도한 요청 시 차단

`meat-secure.js`는 이러한 보안 메커니즘을 우회하면서도 성능을 향상시킵니다. 