<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KFA Crawler Dashboard</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f0f2f5;
            color: #1c1e21;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }
        h1 {
            color: #1877f2;
        }
        .container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 0 8px 16px rgba(0, 0, 0, 0.1);
            padding: 20px;
            width: 80%;
            max-width: 800px;
        }
        .buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        button {
            padding: 12px 20px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            color: #fff;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.1s;
        }
        button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        button:active:not(:disabled) {
            transform: scale(0.98);
        }
        #crawlBtn { background-color: #42b72a; }
        #crawlBtn:hover:not(:disabled) { background-color: #36a420; }
        #uploadBtn { background-color: #1877f2; }
        #uploadBtn:hover:not(:disabled) { background-color: #166fe5; }
        #stopBtn { 
            background-color: #dc3545; 
            display: none;
        }
        #stopBtn:hover:not(:disabled) { background-color: #c82333; }
        
        #logContainer {
            background-color: #000;
            color: #fff;
            font-family: 'Menlo', 'Monaco', 'Consolas', monospace;
            font-size: 13px;
            padding: 15px;
            border-radius: 6px;
            height: 80vh;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-top: 20px;
        }
        .section {
            margin-top: 25px;
        }
        .section h2 {
            font-size: 18px;
            color: #1c1e21;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        textarea {
            width: 100%;
            box-sizing: border-box;
            height: 150px;
            border: 1px solid #ccd0d5;
            border-radius: 6px;
            padding: 10px;
            font-family: 'Menlo', 'Monaco', 'Consolas', monospace;
            font-size: 13px;
        }
        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .control-grid input {
            padding: 10px;
            border: 1px solid #ccd0d5;
            border-radius: 6px;
            font-size: 14px;
        }
        #saveCsvBtn {
            background-color: #6c757d;
            margin-top: 10px;
        }
         #saveCsvBtn:hover:not(:disabled) {
            background-color: #5a6268;
        }
        #copyFiltersBtn:hover:not(:disabled) {
            background-color: #5a6268;
        }
        /* === 리그별 테이블 UI 추가 === */
        #leagueTable {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        #leagueTable th, #leagueTable td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: center;
        }
        #leagueTable th {
            background-color: #f8f9fa;
        }
        .action-btn {
            padding: 4px 10px;
            font-size: 13px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            color: #fff;
        }
        .crawl-row-btn { background-color: #42b72a; }
        .crawl-row-btn:hover { background-color: #36a420; }
        .upload-row-btn { background-color: #1877f2; }
        .upload-row-btn:hover { background-color: #166fe5; }
        /* 레이아웃 개선 */
        .main-wrapper { display: flex; gap: 20px; align-items: flex-start; width:100%; box-sizing: border-box; flex-wrap:nowrap; }
        .left-area { flex: 1 1 60%; min-width:0; }
        .log-panel { flex: 0 0 38%; }
        /* 왼쪽 컨테이너 최대폭 제거 */
        .left-area .container { width:100%; max-width:none; }
        /* 로그인 오버레이 */
        #loginOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        #loginOverlay input { padding: 10px; margin: 5px 0; width: 250px; font-size: 14px; }
        #loginOverlay button { padding: 10px 20px; background: #1877f2; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
        #loginError { margin-top: 10px; color: #dc3545; font-size: 13px; }
        /* 불필요한 구버전 필터 섹션 숨김 */
        #legacyFilters, #legacyUploads { display:none; }
        /* 작업 큐 현황 UI */
        #queueStatusSection { background: #fff; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); padding: 15px; margin-bottom: 20px; }
        #queueStatusSection h3 { margin-top: 0; font-size: 16px; color: #1c1e21; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        #queueStatusSection div { font-family: 'Menlo', 'Monaco', monospace; font-size: 13px; margin-top: 8px; }
        #runningJob, #waitingJobs { display: inline-block; padding: 4px 8px; border-radius: 4px; }
        #runningJob { background-color: #e7f3ff; border: 1px solid #cce0f5; color: #004085; }
        #waitingJobs { background-color: #f8f9fa; border: 1px solid #dee2e6; color: #343a40; }
    </style>
</head>
<body>
    <!-- 로그인 오버레이 -->
    <div id="loginOverlay" style="display:none;">
        <h2>관리자 로그인</h2>
        <input type="text" id="loginUser" placeholder="아이디" />
        <input type="password" id="loginPass" placeholder="비밀번호" />
        <label style="font-size:13px; margin:5px 0;"><input type="checkbox" id="rememberMe" /> 자동 로그인</label>
        <button id="loginBtn">로그인</button>
        <div id="loginError"></div>
    </div>

    <div class="main-wrapper" id="dashboardWrapper" style="display:none;">
        <div class="container left-area">
            <h1>KFA 크롤러 대시보드</h1>
            <div style="text-align: center; margin-bottom: 20px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center; align-items:center;">
                <a href="/dashboard" style="background: #6c757d; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; margin: 0 10px;">📊 Firebase CRUD Dashboard</a>
                <a href="/" style="background: #667eea; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; margin: 0 10px;">🏠 크롤링 대시보드</a>
                <button id="logoutBtn" style="background:#dc3545; color:white; padding:10px 20px; border:none; border-radius:5px;">🚪 로그아웃</button>
            </div>
            
            <!-- 작업 큐 현황 -->
            <div id="queueStatusSection">
                <h3>🚀 작업 큐 현황</h3>
                <div>실행중: <span id="runningJob">없음</span></div>
                <div>대기중: <span id="waitingJobs">없음</span></div>
            </div>
            
            <!-- Git 커밋 정보 표시 -->
            <div id="gitInfo" style="background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; padding: 12px; margin-bottom: 20px; font-size: 13px; color: #495057;">
                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px;">
                    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <span style="font-weight: bold; color: #28a745;">🔄 현재 버전:</span>
                        <span id="gitCommitHash" style="font-family: monospace; background: #e9ecef; padding: 2px 6px; border-radius: 3px;">로딩중...</span>
                        <span id="gitCommitDate" style="color: #6c757d;">로딩중...</span>
                    </div>
                    <button id="refreshGitInfo" style="background: #17a2b8; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">🔄 새로고침</button>
                </div>
                <div id="gitCommitMessage" style="margin-top: 8px; font-style: italic; color: #6c757d;">로딩중...</div>
            </div>
            
            <div class="section">
                <h2>리그 목록 (leagues.csv) <span id="firebaseStatus" style="font-size: 12px; color: #28a745;">🔥 Firebase 연동</span></h2>
                
                <!-- 새 리그 추가 폼 -->
                <div id="newLeagueForm" style="background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; padding: 15px; margin-bottom: 15px; display: none;">
                    <h3 style="margin-top: 0; color: #495057;">🆕 새 리그 추가</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 10px;">
                        <input type="text" id="newLeagueTag" placeholder="리그 태그 (e.g., k1)" style="padding: 8px; border: 1px solid #ced4da; border-radius: 4px;">
                        <input type="text" id="newRegionTag" placeholder="지역 태그 (빈칸 가능)" style="padding: 8px; border: 1px solid #ced4da; border-radius: 4px;">
                        <input type="text" id="newYear" placeholder="년도 (e.g., 2025)" style="padding: 8px; border: 1px solid #ced4da; border-radius: 4px;">
                        <input type="text" id="newLeagueTitle" placeholder="리그 이름 (e.g., K리그1)" style="padding: 8px; border: 1px solid #ced4da; border-radius: 4px;">
                        <input type="text" id="newMatchIdx" placeholder="매치 인덱스 (긴 ID 문자열)" style="padding: 8px; border: 1px solid #ced4da; border-radius: 4px;">
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button id="addNewLeagueBtn" style="background-color: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">✅ 리그 추가</button>
                        <button id="cancelNewLeagueBtn" style="background-color: #6c757d; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">❌ 취소</button>
                    </div>
                    <div style="font-size: 12px; color: #6c757d; margin-top: 10px;">
                        💡 팁: 지역 태그는 빈칸으로 두어도 됩니다 (전국 리그인 경우). 매치 인덱스는 KFA 사이트에서 가져온 고유 ID입니다.
                    </div>
                </div>
                
                <textarea id="csvEditor" placeholder="CSV 데이터를 로딩 중입니다..."></textarea>
                <div style="display: flex; gap: 10px; margin-top: 10px; align-items: center; flex-wrap:wrap;">
                    <button id="saveCsvBtn">Firebase에 저장</button>
                    <button id="refreshCsvBtn" style="background-color: #17a2b8;">🔄 새로고침</button>
                    <button id="showNewLeagueFormBtn" style="background-color: #28a745;">➕ 새 리그 추가</button>
                    <div id="csvSyncStatus" style="font-size: 12px; color: #666; margin-left: 10px;">
                        💡 이제 웹에서 직접 편집하고 저장할 수 있습니다!
                    </div>
                </div>

                <!-- 리그별 액션 테이블 -->
                <div id="leagueTableSection" style="margin-top: 25px;">
                    <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px; margin-bottom:10px;">
                        <h3 style="margin:0;">🏷️ 개별 리그 작업</h3>
                        <button id="refreshTableBtn" style="background-color:#17a2b8; color:white; border:none; padding: 6px 12px; border-radius:4px; font-size:12px;">�� 테이블 새로고침</button>
                    </div>
                    <div style="margin-bottom:10px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                        <button id="crawlSelectedBtn" class="action-btn crawl-row-btn">선택 크롤링</button>
                        <button id="uploadSelectedBtn" class="action-btn upload-row-btn">선택 업로드</button>
                        <label style="font-size:13px;"><input type="checkbox" id="selectAllLeagues" /> 전체 선택</label>
                    </div>

                    <div style="overflow-x:auto;">
                        <table id="leagueTable">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>태그</th>
                                    <th>지역</th>
                                    <th>년도</th>
                                    <th style="text-align:left;">리그 이름</th>
                                    <th>크롤링</th>
                                    <th>업로드</th>
                                    <th>최근 크롤링</th>
                                    <th>최근 업로드</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <p style="font-size: 12px; color: #666; margin-top: 8px;">🕒 "최근 업로드"는 이 페이지에서 실행한 시점을 표시합니다.</p>
                </div>
            </div>

            <div class="section" id="legacyFilters">
                <h2>크롤링 실행 (다중 선택 가능)</h2>
                <div id="crawlingFilters">
                    <div class="filter-row">
                        <div class="control-grid">
                            <input type="text" placeholder="특정 년도 (e.g., 2025)" class="year-filter">
                            <input type="text" placeholder="특정 월 (e.g., 05)" class="month-filter">
                            <input type="text" placeholder="리그명 또는 태그 (e.g., K리그1, k1)" class="league-filter">
                            <button class="remove-filter-btn" onclick="removeFilterRow(this)" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer;">❌</button>
                        </div>
                    </div>
                </div>
                <div style="margin: 10px 0;">
                    <button id="addFilterBtn" style="background-color: #28a745; color: white; border: none; border-radius: 4px; padding: 8px 15px; cursor: pointer;">➕ 필터 추가</button>
                    <button id="clearAllFiltersBtn" style="background-color: #6c757d; color: white; border: none; border-radius: 4px; padding: 8px 15px; cursor: pointer; margin-left: 10px;">🧹 모든 필터 초기화</button>
                </div>
                <div class="buttons" style="margin-top: 15px;">
                    <button id="crawlBtn">1. 데이터 크롤링 시작</button>
                    <button id="stopBtn">🛑 크롤링 중단</button>
                </div>
            </div>

            <div class="section" id="legacyUploads">
                <h2>Firebase 업로드 (다중 선택 가능)</h2>
                <div id="uploadFilters">
                    <div class="filter-row">
                        <div class="control-grid">
                            <input type="text" placeholder="특정 년도 (e.g., 2025)" class="upload-year-filter">
                            <input type="text" placeholder="특정 월 (e.g., 05)" class="upload-month-filter">
                            <input type="text" placeholder="리그명 일부 검색" class="upload-league-filter">
                            <button class="remove-upload-filter-btn" onclick="removeUploadFilterRow(this)" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer;">❌</button>
                        </div>
                    </div>
                </div>
                <div style="margin: 10px 0;">
                    <button id="addUploadFilterBtn" style="background-color: #28a745; color: white; border: none; border-radius: 4px; padding: 8px 15px; cursor: pointer;">➕ 업로드 필터 추가</button>
                    <button id="clearAllUploadFiltersBtn" style="background-color: #6c757d; color: white; border: none; border-radius: 4px; padding: 8px 15px; cursor: pointer; margin-left: 10px;">🧹 모든 업로드 필터 초기화</button>
                </div>
                <div class="buttons" style="margin-top: 15px;">
                    <button id="uploadBtn">2. Firestore에 업로드</button>
                    <button id="stopUploadBtn" style="background-color: #dc3545; display: none;">🛑 업로드 중단</button>
                    <button id="copyFiltersBtn" style="background-color: #6c757d;">크롤링 필터 복사</button>
                </div>
                <p style="font-size: 12px; color: #666; margin-top: 10px;">
                    💡 팁: 필터를 비워두면 모든 데이터를 업로드합니다. "크롤링 필터 복사" 버튼으로 위의 크롤링 조건을 쉽게 복사할 수 있습니다.
                </p>
            </div>
        </div>

        <!-- 로그 패널 오른쪽 -->
        <div class="log-panel">
            <button id="clearLogBtn" style="background:#6c757d; color:#fff; border:none; padding:6px 12px; border-radius:4px; margin-bottom:6px;">🧹 로그 지우기</button>
            <div id="logContainer">작업 로그가 여기에 표시됩니다...</div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const crawlBtn = document.getElementById('crawlBtn');
        const uploadBtn = document.getElementById('uploadBtn');
        const stopBtn = document.getElementById('stopBtn');
        const stopUploadBtn = document.getElementById('stopUploadBtn');
        const logContainer = document.getElementById('logContainer');
        const csvEditor = document.getElementById('csvEditor');
        const saveCsvBtn = document.getElementById('saveCsvBtn');
        const refreshCsvBtn = document.getElementById('refreshCsvBtn');
        
        // 실행 중인 프로세스 추적
        let currentProcesses = new Map();

        // 로그 히스토리 복원 기능
        socket.on('log-history', (history) => {
            logContainer.innerHTML = '🔄 로그 히스토리 복원 중...\n';
            setTimeout(() => {
                logContainer.innerHTML = '';
                history.forEach(entry => {
                    logContainer.innerHTML += `[${new Date(entry.timestamp).toLocaleTimeString()}] ${entry.message}`;
                });
                logContainer.scrollTop = logContainer.scrollHeight;
            }, 100);
        });

        const addFilterBtn = document.getElementById('addFilterBtn');
        const clearAllFiltersBtn = document.getElementById('clearAllFiltersBtn');
        const addUploadFilterBtn = document.getElementById('addUploadFilterBtn');
        const clearAllUploadFiltersBtn = document.getElementById('clearAllUploadFiltersBtn');
        const copyFiltersBtn = document.getElementById('copyFiltersBtn');

        // 다중 필터 관리 함수들
        function addFilterRow() {
            const crawlingFilters = document.getElementById('crawlingFilters');
            const newRow = document.createElement('div');
            newRow.className = 'filter-row';
            newRow.innerHTML = `
                <div class="control-grid">
                    <input type="text" placeholder="특정 년도 (e.g., 2025)" class="year-filter">
                    <input type="text" placeholder="특정 월 (e.g., 05)" class="month-filter">
                    <input type="text" placeholder="리그명 또는 태그 (e.g., K리그1, k1)" class="league-filter">
                    <button class="remove-filter-btn" onclick="removeFilterRow(this)" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer;">❌</button>
                </div>
            `;
            crawlingFilters.appendChild(newRow);
        }

        function removeFilterRow(btn) {
            const filterRows = document.querySelectorAll('#crawlingFilters .filter-row');
            if (filterRows.length > 1) {
                btn.closest('.filter-row').remove();
            } else {
                alert('최소 하나의 필터는 유지되어야 합니다.');
            }
        }

        function clearAllFilters() {
            const filterRows = document.querySelectorAll('#crawlingFilters .filter-row');
            filterRows.forEach((row, index) => {
                if (index === 0) {
                    // 첫 번째 행은 유지하고 값만 초기화
                    row.querySelectorAll('input').forEach(input => input.value = '');
                } else {
                    // 나머지 행은 제거
                    row.remove();
                }
            });
        }

        function addUploadFilterRow() {
            const uploadFilters = document.getElementById('uploadFilters');
            const newRow = document.createElement('div');
            newRow.className = 'filter-row';
            newRow.innerHTML = `
                <div class="control-grid">
                    <input type="text" placeholder="특정 년도 (e.g., 2025)" class="upload-year-filter">
                    <input type="text" placeholder="특정 월 (e.g., 05)" class="upload-month-filter">
                    <input type="text" placeholder="리그명 일부 검색" class="upload-league-filter">
                    <button class="remove-upload-filter-btn" onclick="removeUploadFilterRow(this)" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer;">❌</button>
                </div>
            `;
            uploadFilters.appendChild(newRow);
        }

        function removeUploadFilterRow(btn) {
            const filterRows = document.querySelectorAll('#uploadFilters .filter-row');
            if (filterRows.length > 1) {
                btn.closest('.filter-row').remove();
            } else {
                alert('최소 하나의 업로드 필터는 유지되어야 합니다.');
            }
        }

        function clearAllUploadFilters() {
            const filterRows = document.querySelectorAll('#uploadFilters .filter-row');
            filterRows.forEach((row, index) => {
                if (index === 0) {
                    // 첫 번째 행은 유지하고 값만 초기화
                    row.querySelectorAll('input').forEach(input => input.value = '');
                } else {
                    // 나머지 행은 제거
                    row.remove();
                }
            });
        }

        function getCrawlingFilters() {
            const filters = [];
            const filterRows = document.querySelectorAll('#crawlingFilters .filter-row');
            filterRows.forEach(row => {
                const year = row.querySelector('.year-filter').value.trim();
                const month = row.querySelector('.month-filter').value.trim();
                const league = row.querySelector('.league-filter').value.trim();
                
                // 빈 필터는 제외하고, 하나라도 값이 있으면 포함
                if (year || month || league) {
                    filters.push({ year, month, league });
                }
            });
            return filters;
        }

        function getUploadFilters() {
            const filters = [];
            const filterRows = document.querySelectorAll('#uploadFilters .filter-row');
            filterRows.forEach(row => {
                const year = row.querySelector('.upload-year-filter').value.trim();
                const month = row.querySelector('.upload-month-filter').value.trim();
                const league = row.querySelector('.upload-league-filter').value.trim();
                
                // 빈 필터는 제외하고, 하나라도 값이 있으면 포함
                if (year || month || league) {
                    filters.push({ year, month, league });
                }
            });
            return filters;
        }

        // 이벤트 리스너 추가
        addFilterBtn.addEventListener('click', addFilterRow);
        clearAllFiltersBtn.addEventListener('click', clearAllFilters);
        addUploadFilterBtn.addEventListener('click', addUploadFilterRow);
        clearAllUploadFiltersBtn.addEventListener('click', clearAllUploadFilters);

        // CSV 파일을 새로고침하는 함수
        async function refreshCsvContent() {
            try {
                console.log('🔄 CSV 파일 새로고침 중...');
                const firebaseStatus = document.getElementById('firebaseStatus');
                const csvSyncStatus = document.getElementById('csvSyncStatus');
                
                firebaseStatus.textContent = '🔄 로딩 중...';
                firebaseStatus.style.color = '#ffc107';
                
                const response = await fetch('/leagues-csv?' + new Date().getTime()); // 캐시 방지
                if (response.ok) {
                    const content = await response.text();
                    csvEditor.value = content;
                    console.log('✅ CSV 파일 새로고침 완료');
                    console.log('📄 현재 CSV 내용:', content);
                    
                    // === CSV 파싱 후 테이블 렌더 ===
                    renderLeagueTable(content);
                    
                    // Firebase 연동 상태 업데이트
                    firebaseStatus.textContent = '🔥 Firebase 연동';
                    firebaseStatus.style.color = '#28a745';
                    csvSyncStatus.textContent = '✅ Firebase에서 최신 데이터를 불러왔습니다!';
                    csvSyncStatus.style.color = '#28a745';
                    
                    // 3초 후 기본 메시지로 복원
                    setTimeout(() => {
                        csvSyncStatus.textContent = '💡 이제 웹에서 직접 편집하고 저장할 수 있습니다!';
                        csvSyncStatus.style.color = '#666';
                    }, 3000);
                } else {
                    appendLog('❌ leagues.csv 파일을 불러오는 데 실패했습니다.');
                    firebaseStatus.textContent = '❌ 연결 실패';
                    firebaseStatus.style.color = '#dc3545';
                }
            } catch (error) {
                appendLog(`❌ CSV 로딩 중 오류 발생: ${error.message}`);
                const firebaseStatus = document.getElementById('firebaseStatus');
                firebaseStatus.textContent = '❌ 연결 실패';
                firebaseStatus.style.color = '#dc3545';
            }
        }

                  // Git 정보를 가져오는 함수
          async function loadGitInfo() {
              try {
                  const response = await fetch('/git-info');
                  const data = await response.json();
                  
                  if (data.success) {
                      document.getElementById('gitCommitHash').textContent = data.commit.shortHash;
                      document.getElementById('gitCommitDate').textContent = data.commit.date;
                      document.getElementById('gitCommitMessage').textContent = data.commit.message;
                      
                      // 툴크으로 전체 해시 표시
                      document.getElementById('gitCommitHash').title = `전체 해시: ${data.commit.fullHash}`;
                      
                      console.log('✅ Git 정보 로드 성공:', data.commit);
                  } else {
                      document.getElementById('gitCommitHash').textContent = '오류';
                      document.getElementById('gitCommitDate').textContent = '정보 없음';
                      document.getElementById('gitCommitMessage').textContent = data.error || 'Git 정보를 가져올 수 없습니다.';
                      console.error('❌ Git 정보 로드 실패:', data.error);
                  }
              } catch (error) {
                  document.getElementById('gitCommitHash').textContent = '오류';
                  document.getElementById('gitCommitDate').textContent = '연결 실패';
                  document.getElementById('gitCommitMessage').textContent = '서버 연결에 실패했습니다.';
                  console.error('❌ Git 정보 가져오기 실패:', error);
              }
          }

          // Git 정보 새로고침 버튼 이벤트
          document.getElementById('refreshGitInfo').addEventListener('click', async () => {
              const refreshBtn = document.getElementById('refreshGitInfo');
              const originalText = refreshBtn.textContent;
              
              refreshBtn.textContent = '⏳ 로딩...';
              refreshBtn.disabled = true;
              
              await loadGitInfo();
              
              setTimeout(() => {
                  refreshBtn.textContent = originalText;
                  refreshBtn.disabled = false;
              }, 500);
          });

          // 페이지 로드 시 CSV 데이터와 Git 정보 불러오기
          window.addEventListener('load', () => {
              refreshCsvContent();
              loadGitInfo();
          });

        // CSV 저장 버튼 이벤트
        saveCsvBtn.addEventListener('click', async () => {
            try {
                saveCsvBtn.disabled = true;
                saveCsvBtn.textContent = 'Firebase에 저장 중...';
                
                const firebaseStatus = document.getElementById('firebaseStatus');
                const csvSyncStatus = document.getElementById('csvSyncStatus');
                
                firebaseStatus.textContent = '🔄 저장 중...';
                firebaseStatus.style.color = '#ffc107';
                
                const content = csvEditor.value;
                console.log('클라이언트에서 전송할 CSV 내용 길이:', content.length);
                console.log('CSV 내용 미리보기:', content.substring(0, 100));
                
                const response = await fetch('/leagues-csv', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content: content })
                });

                if (response.ok) {
                    const responseText = await response.text();
                    appendLog('✅ CSV 파일이 Firebase에 성공적으로 저장되었습니다.');
                    console.log('서버 응답:', responseText);
                    
                    // 저장 성공 시 상태 업데이트
                    firebaseStatus.textContent = '🔥 Firebase 연동';
                    firebaseStatus.style.color = '#28a745';
                    saveCsvBtn.style.backgroundColor = '#28a745';
                    saveCsvBtn.textContent = 'Firebase에 저장 완료!';
                    saveCsvBtn.disabled = false; // 즉시 버튼 활성화
                    csvSyncStatus.textContent = '✅ Firebase에 성공적으로 저장되었습니다!';
                    csvSyncStatus.style.color = '#28a745';
                    
                    // 3초 후 기본 상태로 복원
                    setTimeout(() => {
                        saveCsvBtn.style.backgroundColor = '#6c757d';
                        saveCsvBtn.textContent = 'Firebase에 저장';
                        saveCsvBtn.disabled = false; // 버튼 활성화 보장
                        csvSyncStatus.textContent = '💡 이제 웹에서 직접 편집하고 저장할 수 있습니다!';
                        csvSyncStatus.style.color = '#666';
                    }, 3000);
                } else {
                    const errorText = await response.text();
                    appendLog(`❌ CSV 파일 저장에 실패했습니다: ${errorText}`);
                    console.error('서버 오류:', errorText);
                    
                    firebaseStatus.textContent = '❌ 저장 실패';
                    firebaseStatus.style.color = '#dc3545';
                    
                    // 오류 시에도 버튼 활성화
                    saveCsvBtn.disabled = false;
                    saveCsvBtn.textContent = 'Firebase에 저장';
                    saveCsvBtn.style.backgroundColor = '#6c757d';
                }
            } catch (error) {
                appendLog(`❌ CSV 저장 중 오류 발생: ${error.message}`);
                console.error('CSV 저장 오류:', error);
                
                const firebaseStatus = document.getElementById('firebaseStatus');
                firebaseStatus.textContent = '❌ 저장 실패';
                firebaseStatus.style.color = '#dc3545';
                
                // 예외 발생 시에도 버튼 활성화
                saveCsvBtn.disabled = false;
                saveCsvBtn.textContent = 'Firebase에 저장';
                saveCsvBtn.style.backgroundColor = '#6c757d';
            } finally {
                // finally 블록에서 확실히 버튼 활성화
                if (saveCsvBtn.textContent.includes('저장 중')) {
                    saveCsvBtn.disabled = false;
                    saveCsvBtn.textContent = 'Firebase에 저장';
                    saveCsvBtn.style.backgroundColor = '#6c757d';
                }
            }
        });

        function disableButtons() {
            crawlBtn.disabled = true;
            uploadBtn.disabled = true;
        }

        function enableButtons() {
            crawlBtn.disabled = false;
            uploadBtn.disabled = false;
            stopBtn.style.display = 'none';
            stopUploadBtn.style.display = 'none';
        }

        function showStopButton(processType) {
            if (processType === 'crawling') {
                stopBtn.style.display = 'inline-block';
            } else if (processType === 'uploading') {
                stopUploadBtn.style.display = 'inline-block';
            }
        }

        function hideStopButton(processType) {
            if (processType === 'crawling') {
                stopBtn.style.display = 'none';
            } else if (processType === 'uploading') {
                stopUploadBtn.style.display = 'none';
            }
        }

        function appendLog(message) {
            // ANSI 이스케이프 시퀀스(컬러 코드)를 제거하는 정규식
            const cleanMessage = message.replace(/[\u001b\u009b][[()#;?]*.?[0-9]{1,4}(?:;[0-9]{0,4})*.?[0-9A-ORZcf-nqry=><]/g, '');
            logContainer.innerHTML += cleanMessage.replace(/\n/g, '<br>');
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        socket.on('connect', () => {
            logContainer.innerHTML = '✅ 서버에 연결되었습니다.<br>';
        });

        socket.on('log', (message) => {
            if (message.includes('프로세스가 종료되었습니다')) {
                enableButtons();
            }
            appendLog(message);
        });

        // === 업로드 프로세스 트래킹 ===
        const awaitingUploadKeys = [];
        const awaitingCrawlKeys = [];

        // 프로세스 시작 이벤트
        socket.on('process-started', (data) => {
            const { processId, type } = data;
            if(type==='uploading'){
                const key=awaitingUploadKeys.shift()||null;
                currentProcesses.set(processId,{type, key});
            }else if(type==='crawling'){
                const key=awaitingCrawlKeys.shift()||null;
                currentProcesses.set(processId,{type, key});
            }else{
                currentProcesses.set(processId,{type});
            }
            showStopButton(type);
            console.log(`프로세스 시작: ${processId} (${type})`);
        });

        // 프로세스 종료 이벤트
        socket.on('process-ended', (data) => {
            const { processId, type } = data;
            const procInfo=currentProcesses.get(processId)||{type};
            currentProcesses.delete(processId);
            hideStopButton(type);
            enableButtons();

            // 타임스탬프 생성 함수
            const ts=()=>{
                const n=new Date();
                return `${n.getFullYear()}-${(n.getMonth()+1).toString().padStart(2,'0')}-${n.getDate().toString().padStart(2,'0')} ${n.getHours().toString().padStart(2,'0')}:${n.getMinutes().toString().padStart(2,'0')}`;
            };

            // 업로드 완료 시 시간 기록
            if(type==='uploading' && procInfo.key){
                const label=ts();
                localStorage.setItem('upload_'+procInfo.key,label);
                const cell=document.getElementById('upload-'+procInfo.key);
                if(cell) cell.textContent=label;
            }

            // 크롤링 완료 시 시간 기록
            if(type==='crawling' && procInfo.key){
                const label=ts();
                localStorage.setItem('crawl_'+procInfo.key,label);
                const cell=document.getElementById('crawl-'+procInfo.key);
                if(cell) cell.textContent=label;
            }

            console.log(`프로세스 종료: ${processId} (${type})`);
        });

        crawlBtn.addEventListener('click', () => {
            logContainer.innerHTML = '';
            disableButtons();
            
            const filters = getCrawlingFilters();
            
            if (filters.length === 0) {
                // 필터가 없으면 전체 크롤링
                const options = { year: '', month: '', league: '' };
                appendLog('📋 전체 크롤링을 시작합니다...\n');
                socket.emit('start-crawling', options);
            } else {
                // 다중 필터로 순차 실행
                appendLog(`📋 ${filters.length}개의 필터 조건으로 크롤링을 시작합니다...\n`);
                filters.forEach((filter, index) => {
                    appendLog(`  ${index + 1}. 년도: ${filter.year || '전체'}, 월: ${filter.month || '전체'}, 리그: ${filter.league || '전체'}\n`);
                });
                appendLog('\n');
                
                let currentFilterIndex = 0;
                
                function runNextCrawling() {
                    if (currentFilterIndex < filters.length) {
                        const options = filters[currentFilterIndex];
                        appendLog(`🚀 [${currentFilterIndex + 1}/${filters.length}] 크롤링 실행 중...\n`);
                        socket.emit('start-crawling', options);
                        currentFilterIndex++;
                    }
                }
                
                // 프로세스 종료 시 다음 크롤링 실행을 위한 임시 핸들러
                const multiCrawlingEndHandler = (data) => {
                    if (data.type === 'crawling') {
                        setTimeout(() => {
                            if (currentFilterIndex < filters.length) {
                                runNextCrawling();
                            } else {
                                // 모든 크롤링 완료
                                appendLog(`\n🎉 모든 크롤링이 완료되었습니다! (총 ${filters.length}개 조건)\n`);
                                enableButtons();
                                socket.off('process-ended', multiCrawlingEndHandler);
                            }
                        }, 1000);
                    }
                };
                
                socket.on('process-ended', multiCrawlingEndHandler);
                
                // 첫 번째 크롤링 시작
                runNextCrawling();
            }
        });

        uploadBtn.addEventListener('click', () => {
            logContainer.innerHTML = '';
            disableButtons();
            
            const filters = getUploadFilters();
            
            if (filters.length === 0) {
                // 필터가 없으면 전체 업로드
                const uploadOptions = { year: '', month: '', league: '' };
                appendLog('📋 전체 데이터를 업로드합니다...\n');
                socket.emit('start-uploading', uploadOptions);
            } else {
                // 다중 필터로 순차 실행
                appendLog(`📋 ${filters.length}개의 필터 조건으로 업로드를 시작합니다...\n`);
                filters.forEach((filter, index) => {
                    appendLog(`  ${index + 1}. 년도: ${filter.year || '전체'}, 월: ${filter.month || '전체'}, 리그: ${filter.league || '전체'}\n`);
                });
                appendLog('\n');
                
                let currentFilterIndex = 0;
                
                function runNextUpload() {
                    if (currentFilterIndex < filters.length) {
                        const uploadOptions = filters[currentFilterIndex];
                        appendLog(`☁️ [${currentFilterIndex + 1}/${filters.length}] 업로드 실행 중...\n`);
                        socket.emit('start-uploading', uploadOptions);
                        currentFilterIndex++;
                    }
                }
                
                // 프로세스 종료 시 다음 업로드 실행을 위한 임시 핸들러
                const multiUploadEndHandler = (data) => {
                    if (data.type === 'uploading') {
                        setTimeout(() => {
                            if (currentFilterIndex < filters.length) {
                                runNextUpload();
                            } else {
                                // 모든 업로드 완료
                                appendLog(`\n🎉 모든 업로드가 완료되었습니다! (총 ${filters.length}개 조건)\n`);
                                enableButtons();
                                socket.off('process-ended', multiUploadEndHandler);
                            }
                        }, 1000);
                    }
                };
                
                socket.on('process-ended', multiUploadEndHandler);
                
                // 첫 번째 업로드 시작
                runNextUpload();
            }
        });

        // 크롤링 필터 복사 버튼 이벤트
        copyFiltersBtn.addEventListener('click', () => {
            const crawlingFilters = getCrawlingFilters();
            const uploadFiltersContainer = document.getElementById('uploadFilters');
            
            // 기존 업로드 필터 모두 제거
            uploadFiltersContainer.innerHTML = '';
            
            if (crawlingFilters.length === 0) {
                // 크롤링 필터가 없으면 빈 업로드 필터 하나 생성
                uploadFiltersContainer.innerHTML = `
                    <div class="filter-row">
                        <div class="control-grid">
                            <input type="text" placeholder="특정 년도 (e.g., 2025)" class="upload-year-filter">
                            <input type="text" placeholder="특정 월 (e.g., 05)" class="upload-month-filter">
                            <input type="text" placeholder="리그명 일부 검색" class="upload-league-filter">
                            <button class="remove-upload-filter-btn" onclick="removeUploadFilterRow(this)" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer;">❌</button>
                        </div>
                    </div>
                `;
            } else {
                // 크롤링 필터를 업로드 필터로 복사
                crawlingFilters.forEach(filter => {
                    const newRow = document.createElement('div');
                    newRow.className = 'filter-row';
                    newRow.innerHTML = `
                        <div class="control-grid">
                            <input type="text" placeholder="특정 년도 (e.g., 2025)" class="upload-year-filter" value="${filter.year || ''}">
                            <input type="text" placeholder="특정 월 (e.g., 05)" class="upload-month-filter" value="${filter.month || ''}">
                            <input type="text" placeholder="리그명 일부 검색" class="upload-league-filter" value="${filter.league || ''}">
                            <button class="remove-upload-filter-btn" onclick="removeUploadFilterRow(this)" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer;">❌</button>
                        </div>
                    `;
                    uploadFiltersContainer.appendChild(newRow);
                });
            }
            
            // 시각적 피드백
            copyFiltersBtn.textContent = '복사 완료!';
            copyFiltersBtn.style.backgroundColor = '#28a745';
            setTimeout(() => {
                copyFiltersBtn.textContent = '크롤링 필터 복사';
                copyFiltersBtn.style.backgroundColor = '#6c757d';
            }, 1000);
        });

         // 크롤링 중단 버튼 이벤트
         stopBtn.addEventListener('click', () => {
             const crawlingProcess = Array.from(currentProcesses.entries()).find(([id, type]) => type === 'crawling');
             if (crawlingProcess) {
                 const [processId] = crawlingProcess;
                 socket.emit('stop-process', { processId });
                 stopBtn.disabled = true;
                 stopBtn.textContent = '중단 중...';
                 
                 // 5초 후 버튼 복원 (안전장치)
                 setTimeout(() => {
                     stopBtn.disabled = false;
                     stopBtn.textContent = '🛑 크롤링 중단';
                                   }, 5000);
              }
          });

          // CSV 새로고침 버튼 이벤트
          refreshCsvBtn.addEventListener('click', async () => {
              refreshCsvBtn.disabled = true;
              refreshCsvBtn.textContent = '새로고침 중...';
              
              try {
                  await refreshCsvContent();
                  appendLog('✅ CSV 파일이 새로고침되었습니다.');
              } catch (error) {
                  appendLog(`❌ CSV 새로고침 실패: ${error.message}`);
              } finally {
                  refreshCsvBtn.disabled = false;
                  refreshCsvBtn.textContent = '🔄 새로고침';
              }
          });

          // 새 리그 추가 관련 이벤트 리스너들
          const showNewLeagueFormBtn = document.getElementById('showNewLeagueFormBtn');
          const newLeagueForm = document.getElementById('newLeagueForm');
          const addNewLeagueBtn = document.getElementById('addNewLeagueBtn');
          const cancelNewLeagueBtn = document.getElementById('cancelNewLeagueBtn');

          showNewLeagueFormBtn.addEventListener('click', () => {
              newLeagueForm.style.display = newLeagueForm.style.display === 'none' ? 'block' : 'none';
              showNewLeagueFormBtn.textContent = newLeagueForm.style.display === 'none' ? '➕ 새 리그 추가' : '➖ 폼 닫기';
          });

          cancelNewLeagueBtn.addEventListener('click', () => {
              newLeagueForm.style.display = 'none';
              showNewLeagueFormBtn.textContent = '➕ 새 리그 추가';
              // 폼 초기화
              ['newLeagueTag', 'newRegionTag', 'newYear', 'newLeagueTitle', 'newMatchIdx'].forEach(id => {
                  document.getElementById(id).value = '';
              });
          });

          addNewLeagueBtn.addEventListener('click', () => {
              const leagueTag = document.getElementById('newLeagueTag').value.trim();
              const regionTag = document.getElementById('newRegionTag').value.trim();
              const year = document.getElementById('newYear').value.trim();
              const leagueTitle = document.getElementById('newLeagueTitle').value.trim();
              const matchIdx = document.getElementById('newMatchIdx').value.trim();

              // 필수 필드 검증
              if (!leagueTag || !year || !leagueTitle || !matchIdx) {
                  alert('⚠️ 리그 태그, 년도, 리그 이름, 매치 인덱스는 필수 입력 항목입니다.');
                  return;
              }

              // CSV에 새 줄 추가
              const newRow = `${leagueTag},${regionTag},${year},${leagueTitle},${matchIdx}`;
              const currentCsv = csvEditor.value.trim();
              
              // 중복 검사
              if (currentCsv.includes(`${leagueTag},${regionTag},${year}`)) {
                  alert('⚠️ 이미 동일한 리그 태그, 지역, 년도의 조합이 존재합니다.');
                  return;
              }
              
              csvEditor.value = currentCsv + '\n' + newRow;
              
              // 성공 메시지
              appendLog(`✅ 새 리그가 추가되었습니다: ${leagueTitle} (${leagueTag})`);
              appendLog(`💾 "Firebase에 저장" 버튼을 클릭하여 변경사항을 저장하세요.`);
              
              // 폼 초기화 및 닫기
              ['newLeagueTag', 'newRegionTag', 'newYear', 'newLeagueTitle', 'newMatchIdx'].forEach(id => {
                  document.getElementById(id).value = '';
              });
              newLeagueForm.style.display = 'none';
              showNewLeagueFormBtn.textContent = '➕ 새 리그 추가';
          });

         // 업로드 중단 버튼 이벤트
         stopUploadBtn.addEventListener('click', () => {
             const uploadingProcess = Array.from(currentProcesses.entries()).find(([id, type]) => type === 'uploading');
             if (uploadingProcess) {
                 const [processId] = uploadingProcess;
                 socket.emit('stop-process', { processId });
                 stopUploadBtn.disabled = true;
                 stopUploadBtn.textContent = '중단 중...';
                 
                 // 5초 후 버튼 복원 (안전장치)
                 setTimeout(() => {
                     stopUploadBtn.disabled = false;
                     stopUploadBtn.textContent = '🛑 업로드 중단';
                 }, 5000);
             }
         });

        // ======================= 리그 테이블 JS =======================
        function parseCsvToArray(csv) {
            const lines = csv.trim().split('\n');
            const result = [];
            if (lines.length < 2) return result;
            for (let i = 1; i < lines.length; i++) {
                const cols = lines[i].split(',');
                if (cols.length < 5) continue; // 누락 데이터 방지
                const [leagueTag, regionTag, year, leagueTitle, matchIdx] = cols;
                if (!leagueTag) continue;
                result.push({ leagueTag, regionTag, year, leagueTitle, matchIdx });
            }
            return result;
        }

        function renderLeagueTable(csvContent) {
            const tableBody = document.querySelector('#leagueTable tbody');
            if (!tableBody) return;
            tableBody.innerHTML = '';
            const leagues = parseCsvToArray(csvContent);
            leagues.forEach((l) => {
                const key = `${l.leagueTag}_${l.regionTag}_${l.year}`;
                const tr = document.createElement('tr');
                const regionDisplay = l.regionTag && l.regionTag.trim() !== '' ? l.regionTag : '전국';
                tr.innerHTML = `
                    <td><input type="checkbox" class="select-league" data-key="${key}"></td>
                    <td>${l.leagueTag}</td>
                    <td>${regionDisplay}</td>
                    <td>${l.year}</td>
                    <td style="text-align:left;">${l.leagueTitle}</td>
                    <td><button class="action-btn crawl-row-btn" data-key="${key}">크롤</button></td>
                    <td><button class="action-btn upload-row-btn" data-key="${key}">업로드</button></td>
                    <td class="crawl-time" id="crawl-${key}">${localStorage.getItem('crawl_'+key) || '-'}</td>
                    <td class="upload-time" id="upload-${key}">${localStorage.getItem('upload_'+key) || '-'}</td>
                `;
                tableBody.appendChild(tr);
            });
        }

        // 테이블 내 버튼 클릭 처리 (이벤트 위임)
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('crawl-row-btn')) {
                const key = e.target.dataset.key;
                const [leagueTag, regionTag, year] = key.split('_');
                disableButtons();
                appendLog(`🚀 [${leagueTag} ${year}] 개별 크롤링을 시작합니다...`);
                if (!awaitingCrawlKeys.includes(key)) awaitingCrawlKeys.push(key);
                socket.emit('start-crawling', { year, league: leagueTag });
                e.target.disabled = true;
            }
            if (e.target.classList.contains('upload-row-btn')) {
                const key = e.target.dataset.key;
                const [leagueTag, regionTag, year] = key.split('_');
                disableButtons();
                appendLog(`☁️ [${leagueTag} ${year}] 개별 업로드를 시작합니다...`);
                keys.forEach(k=>{ const [tag, region, year] = k.split('_'); if(!awaitingUploadKeys.includes(k)) awaitingUploadKeys.push(k); socket.emit('start-uploading', { year, league: tag }); });
            }
        });

        // === 선택 작업 버튼 ===
        document.getElementById('selectAllLeagues').addEventListener('change', (e)=>{
            document.querySelectorAll('.select-league').forEach(cb=>{ cb.checked = e.target.checked; });
        });

        document.getElementById('crawlSelectedBtn').addEventListener('click', ()=>{
            const keys = Array.from(document.querySelectorAll('.select-league:checked')).map(cb=>cb.dataset.key);
            if(keys.length===0){ alert('리그를 선택하세요.'); return; }
            disableButtons();
            appendLog(`🚀 선택된 ${keys.length}개 리그 크롤링을 시작합니다...`);
            keys.forEach(k=>{ const [tag, region, year] = k.split('_'); if(!awaitingCrawlKeys.includes(k)) awaitingCrawlKeys.push(k); socket.emit('start-crawling', { year, league: tag }); });
        });

        document.getElementById('uploadSelectedBtn').addEventListener('click', ()=>{
            const keys = Array.from(document.querySelectorAll('.select-league:checked')).map(cb=>cb.dataset.key);
            if(keys.length===0){ alert('리그를 선택하세요.'); return; }
            disableButtons();
            appendLog(`☁️ 선택된 ${keys.length}개 리그 업로드를 시작합니다...`);
            keys.forEach(k=>{ const [tag, region, year] = k.split('_'); if(!awaitingUploadKeys.includes(k)) awaitingUploadKeys.push(k); socket.emit('start-uploading', { year, league: tag }); });
        });

        // === 테이블 새로고침 버튼 ===
        document.getElementById('refreshTableBtn').addEventListener('click', () => {
            if (csvEditor.value) {
                renderLeagueTable(csvEditor.value);
                appendLog('🔄 테이블 표시가 새로고침 되었습니다.');
            }
        });

        // === 작업 큐 상태 업데이트 ===
        socket.on('queue-status', (status) => {
            const { running, waiting } = status;
            const runningJobEl = document.getElementById('runningJob');
            const waitingJobsEl = document.getElementById('waitingJobs');

            if (running) {
                const year = running.year || '전체';
                const league = running.league || '전체';
                runningJobEl.textContent = `${league} (${year})`;
            } else {
                runningJobEl.textContent = '없음';
            }

            if (waiting && waiting.length > 0) {
                const waitingText = waiting.map(j => `${j.league || '전체'}(${j.year || '전체'})`).join(', ');
                waitingJobsEl.textContent = `${waiting.length}개 대기중: ${waitingText}`;
            } else {
                waitingJobsEl.textContent = '없음';
            }
        });

        // === 로그 지우기 ===
        document.getElementById('clearLogBtn').addEventListener('click', ()=>{ logContainer.innerHTML=''; });

        // ================= 로그인 기능 =================
        (function initLogin(){
            const overlay = document.getElementById('loginOverlay');
            const dashboard = document.getElementById('dashboardWrapper');
            const stored = localStorage.getItem('loggedIn');
            if(stored==='true'){
                overlay.style.display='none';
                dashboard.style.display='block';
            }else{
                overlay.style.display='flex';
            }
            document.getElementById('loginBtn').addEventListener('click', ()=>{
                const u=document.getElementById('loginUser').value.trim();
                const p=document.getElementById('loginPass').value.trim();
                const err=document.getElementById('loginError');
                if(u==='essaisko' && p==='60687452'){
                    if(document.getElementById('rememberMe').checked){ localStorage.setItem('loggedIn','true'); }
                    overlay.style.display='none';
                    dashboard.style.display='block';
                }else{
                    err.textContent='로그인 정보가 올바르지 않습니다.';
                }
            });
        })();

        // 로그아웃
        document.getElementById('logoutBtn').addEventListener('click',()=>{
            localStorage.removeItem('loggedIn');
            location.reload();
        });
    </script>
</body>
</html> 